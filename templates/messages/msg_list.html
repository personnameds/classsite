{% extends "base.html" %}


{% block main_content %}
	
	<!-- fix look of add button -->
	<div class="main">
		<div class="main_h1">Messages</div>
		<div class="clearer"></div>		
		
		<div class="message_h3">{{topic.topic}}</div>
		<a href="/{{class_url}}/messages/{{topic.id}}/add_message"><div class="add_message_button"></div></a>
		<div class="clearer"></div>	
		<div class="message_text">Applies to - {{topic.homework}}</div>		
		<div class="clearer"></div>	
		
		
		{% for m in msg_list %}

				{% if forloop.first %}
					<div class="message_text_first">{{m.msg_text}}</div>					
				{%else%}
					<div class="message_text">{{m.msg_text}}</div>						
				{%endif %}

				<div class="message_info">
					
					{% ifnotequal m.author user %}
					<a href="/{{class_url}}/messages/{{topic.id}}/{{m.id}}/reply">
						<span class="message_reply_change">Reply</span>
					</a>
					{% endifnotequal %}
					
					{% ifequal m.author user %}
					<a href="/{{class_url}}/messages/{{topic.id}}/{{m.id}}/delete">
						<span class="message_reply_change">Delete</span>
					</a>
					{% endifequal %}
					
					{% if user.is_staff %}
					    {% ifnotequal m.author user %}
					    <a href="/{{class_url}}/messages/{{topic.id}}/{{m.id}}/delete">
						<span class="message_reply_change">Delete</span>
					    </a>
					    {% endifnotequal %}		
					{% endif %}
					
					Written by {{m.author.first_name}} {{m.entered_on|timesince}} ago
					
				</div>

				{%for r in m.msg_set.all%}	
					<div class="reply_text">{{r.msg_text}}</div>
				
				
					<div class="message_info">
						
						{% ifequal r.author user %}
						<a href="/{{class_url}}/messages/{{topic.id}}/{{r.id}}/delete">
							<span class="message_reply_delete">Delete</span>
						</a>
						{% endifequal %}
						
						{% if user.is_staff %}
					        {% ifnotequal r.author user %}
					        <a href="/{{class_url}}/messages/{{topic.id}}/{{r.id}}/delete">
						    <span class="message_reply_delete">Delete</span>
					        </a>
					        {% endifnotequal %}		
					    {% endif %}
						
						Written by {{r.author.first_name}} {{r.entered_on|timesince}} ago
						
					</div>
				

				{%endfor%}
	

		{%endfor%}
		
	</div>
	

{% endblock %}

